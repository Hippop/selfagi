# SelfAGI 系统实现说明

## 项目概述

本项目实现了README文档中描述的自主任务执行系统（SelfAGI），包含完整的系统架构、核心组件和功能模块。

## 系统架构

### 整体架构
```
┌─────────────────────────────────────────────────────────────┐
│                    用户接口层                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │   Web API   │ │  CLI工具    │ │   Web界面   │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
├─────────────────────────────────────────────────────────────┤
│                    业务逻辑层                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │ 任务管理器   │ │ 知识库管理   │ │ 系统协调器   │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
├─────────────────────────────────────────────────────────────┤
│                    执行引擎层                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │ 任务执行器   │ │ 断点管理器   │ │ 结果收集器   │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
├─────────────────────────────────────────────────────────────┤
│                    数据存储层                                │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │ 任务数据库   │ │ 知识库      │ │ 日志存储     │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

## 核心组件

### 1. 任务管理器 (TaskManager)
- **位置**: `src/managers/task_manager.py`
- **功能**: 负责任务的创建、分解、调度和监控
- **主要特性**:
  - 任务创建和配置
  - 任务依赖关系解析
  - 任务优先级计算
  - 任务执行调度
  - 执行状态监控
  - 支持任务暂停、恢复、取消

### 2. 系统协调器 (SystemCoordinator)
- **位置**: `src/managers/system_coordinator.py`
- **功能**: 协调各个组件的工作
- **主要特性**:
  - 系统状态管理
  - 资源分配和调度
  - 组件间通信协调
  - 异常处理和恢复
  - 健康检查和监控
  - 性能指标收集

### 3. 任务执行器 (TaskExecutor)
- **位置**: `src/executors/`
- **功能**: 执行具体的任务操作
- **已实现执行器**:
  - **LLM执行器**: 大模型推理、代码生成、决策制定
  - **Shell执行器**: 系统命令执行、文件操作、环境配置
- **扩展性**: 支持添加新的执行器类型

### 4. 任务分析器 (TaskAnalyzer)
- **位置**: `src/utils/task_analyzer.py`
- **功能**: 分析任务依赖、分解复杂任务
- **主要特性**:
  - 任务复杂度评估
  - 依赖关系分析
  - 任务分解策略
  - 模式识别
  - 优化建议

### 5. 任务存储 (TaskStorage)
- **位置**: `src/storage/`
- **功能**: 管理任务数据的存储和检索
- **已实现存储**:
  - **内存存储**: 用于开发和测试环境
- **扩展性**: 支持添加数据库存储等

## 数据模型

### 核心模型
- **Task**: 任务模型，包含任务的所有属性和配置
- **TaskResult**: 任务执行结果
- **TaskExecutionLog**: 任务执行日志
- **TaskDependency**: 任务依赖关系

### 枚举类型
- **TaskStatus**: 任务状态（pending, running, completed, failed, paused, cancelled）
- **TaskPriority**: 任务优先级（low, normal, high, urgent）
- **TaskType**: 任务类型（computation, io, network, storage, mixed）

## API接口

### RESTful API
- **基础路径**: `/`
- **文档**: `/docs` (Swagger UI)
- **主要端点**:
  - `GET /health` - 健康检查
  - `GET /system/info` - 系统信息
  - `GET /system/status` - 系统状态
  - `GET /system/metrics` - 性能指标
  - `POST /tasks` - 创建任务
  - `GET /tasks/{task_id}` - 获取任务
  - `PUT /tasks/{task_id}` - 更新任务
  - `DELETE /tasks/{task_id}` - 删除任务
  - `POST /tasks/list` - 列出任务
  - `POST /tasks/search` - 搜索任务
  - `POST /tasks/sample` - 创建示例任务

## 配置管理

### 配置文件
- **位置**: `config/settings.py`
- **配置项**:
  - 数据库连接
  - Redis配置
  - API设置
  - 任务执行配置
  - LLM API密钥
  - 日志配置

### 环境变量
支持通过`.env`文件或环境变量进行配置

## 启动方式

### 1. 直接运行系统
```bash
python run.py
```

### 2. 启动API服务
```bash
python run_api.py
```

### 3. 使用uvicorn启动API
```bash
uvicorn src.api.app:app --host 0.0.0.0 --port 8000 --reload
```

## 测试

### 运行测试
```bash
# 安装测试依赖
pip install pytest pytest-asyncio

# 运行测试
pytest tests/
```

### 测试覆盖
- 存储功能测试
- 任务分析器测试
- 基本功能验证

## 部署要求

### 环境要求
- **Python版本**: 3.8+
- **操作系统**: Linux (推荐 Ubuntu 20.04+)
- **内存**: 最小8GB，推荐16GB+
- **存储**: 最小100GB可用空间

### 依赖组件
- **Python包**: 见 `requirements.txt`
- **系统工具**: 无特殊要求（当前使用内存存储）

## 扩展指南

### 添加新执行器
1. 继承 `BaseExecutor` 类
2. 实现 `execute` 和 `validate_task` 方法
3. 在 `SystemCoordinator` 中注册

### 添加新存储后端
1. 实现 `TaskStorage` 接口
2. 在配置中指定存储类型
3. 更新存储初始化逻辑

### 添加新任务类型
1. 在 `TaskType` 枚举中添加新类型
2. 更新任务分析器逻辑
3. 添加相应的执行器支持

## 监控和日志

### 日志系统
- 使用 `loguru` 进行日志管理
- 支持控制台和文件输出
- 日志轮转和保留策略

### 监控指标
- 任务执行统计
- 系统性能指标
- 资源使用情况
- 健康状态监控

## 故障处理

### 异常恢复
- 自动重试机制
- 系统状态监控
- 故障自动恢复
- 紧急关闭机制

### 数据备份
- 自动备份任务数据
- 备份文件管理
- 数据恢复功能

## 性能优化

### 并发处理
- 异步任务执行
- 任务队列管理
- 负载均衡
- 资源限制

### 缓存策略
- 任务结果缓存
- 依赖关系缓存
- 分析结果缓存

## 安全特性

### 访问控制
- API接口验证
- 任务执行权限
- 资源访问控制

### 数据安全
- 敏感数据加密
- 审计日志记录
- 输入验证和过滤

## 未来规划

### 短期目标
- 添加更多执行器类型
- 实现数据库存储后端
- 完善Web管理界面
- 增加更多测试用例

### 长期目标
- 分布式部署支持
- 机器学习优化
- 高级任务调度算法
- 企业级功能

## 贡献指南

### 代码规范
- 遵循PEP 8规范
- 使用类型注解
- 编写文档字符串
- 添加单元测试

### 提交规范
- 清晰的提交信息
- 功能分支开发
- 代码审查流程
- 测试覆盖率要求

---

**项目状态**: 基础功能已实现，可运行  
**最后更新**: 2024年12月  
**维护者**: SelfAGI Team